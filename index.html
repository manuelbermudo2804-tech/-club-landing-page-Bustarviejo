<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hazte Socio - CD Bustarviejo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3a5f 0%, #0d1b2a 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            padding: 30px 20px;
            color: white;
        }
        .header img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 4px solid #f97316;
            margin-bottom: 15px;
            object-fit: cover;
        }
        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        .header p {
            opacity: 0.9;
            font-size: 1rem;
        }
        .benefits {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
        }
        .benefits h3 {
            color: #166534;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        .benefits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .benefit-item {
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .benefit-item h4 {
            color: #1e293b;
            font-size: 0.95rem;
            margin-bottom: 5px;
        }
        .benefit-item p {
            color: #64748b;
            font-size: 0.85rem;
        }
        .share-box {
            background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            text-align: center;
            color: white;
        }
        .share-box h3 {
            margin-bottom: 10px;
        }
        .share-box p {
            opacity: 0.9;
            margin-bottom: 15px;
        }
        .share-btn {
            background: white;
            color: #16a34a;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .share-btn:hover {
            transform: scale(1.05);
        }
        .form-card {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        .form-header {
            background: linear-gradient(135deg, #f97316 0%, #16a34a 100%);
            padding: 20px;
            color: white;
        }
        .form-header h2 {
            font-size: 1.3rem;
        }
        .form-body {
            padding: 25px;
        }
        .error-message {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: none;
        }
        .referral-banner {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border: 2px solid #16a34a;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
        }
        .referral-banner p {
            color: #166534;
            margin: 0;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 8px;
        }
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }
        .form-group input:focus {
            outline: none;
            border-color: #f97316;
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        @media (max-width: 600px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .radio-option {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .radio-option:hover {
            border-color: #f97316;
        }
        .radio-option.selected {
            border-color: #16a34a;
            background: #ecfdf5;
        }
        .radio-option input {
            margin-top: 3px;
        }
        .radio-content h4 {
            color: #1e293b;
            font-size: 1rem;
            margin-bottom: 3px;
        }
        .radio-content p {
            color: #64748b;
            font-size: 0.85rem;
        }
        .payment-box {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border: 2px solid #16a34a;
            border-radius: 16px;
            padding: 20px;
            margin: 25px 0;
        }
        .payment-box h3 {
            color: #166534;
            margin-bottom: 15px;
        }
        .bank-details {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .iban {
            background: #f1f5f9;
            padding: 12px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 1.1rem;
            text-align: center;
            cursor: pointer;
            transition: background 0.2s;
            margin-bottom: 10px;
        }
        .iban:hover {
            background: #e2e8f0;
        }
        .concept {
            font-size: 0.9rem;
            color: #475569;
        }
        .upload-section {
            background: white;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
        }
        .upload-section h4 {
            color: #1e293b;
            margin-bottom: 8px;
        }
        .upload-section > p {
            color: #64748b;
            font-size: 0.85rem;
            margin-bottom: 15px;
        }
        .file-input {
            display: none;
        }
        .upload-btn {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .upload-btn:hover {
            transform: scale(1.02);
        }
        .upload-btn:disabled {
            background: #94a3b8;
            cursor: not-allowed;
            transform: none;
        }
        .upload-preview {
            margin-top: 15px;
            padding: 12px;
            background: #ecfdf5;
            border-radius: 8px;
            color: #166534;
            display: none;
        }
        .upload-error {
            margin-top: 15px;
            padding: 12px;
            background: #fef2f2;
            border-radius: 8px;
            color: #dc2626;
            display: none;
        }
        .submit-btn {
            width: 100%;
            background: linear-gradient(135deg, #f97316 0%, #16a34a 100%);
            color: white;
            border: none;
            padding: 18px;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 20px;
        }
        .submit-btn:hover:not(:disabled) {
            transform: scale(1.02);
            box-shadow: 0 5px 20px rgba(249, 115, 22, 0.4);
        }
        .submit-btn:disabled {
            background: #94a3b8;
            cursor: not-allowed;
            transform: none;
        }
        .success-message {
            text-align: center;
            padding: 40px 20px;
            display: none;
        }
        .success-message h2 {
            color: #166534;
            margin-bottom: 10px;
        }
        .success-message p {
            color: #475569;
        }
        .footer {
            text-align: center;
            padding: 30px 20px;
            color: rgba(255,255,255,0.7);
        }
        .footer a {
            color: #f97316;
            text-decoration: none;
        }
        .copy-toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #1e293b;
            color: white;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: 600;
            transition: transform 0.3s;
            z-index: 1000;
        }
        .copy-toast.show {
            transform: translateX(-50%) translateY(0);
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            text-align: center;
            animation: modalIn 0.3s ease-out;
        }
        @keyframes modalIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        .modal-content h2 {
            color: #166534;
            margin: 20px 0 10px;
        }
        .modal-content p {
            color: #475569;
            margin-bottom: 10px;
        }
        .modal-close {
            background: linear-gradient(135deg, #f97316 0%, #16a34a 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <!-- Copy Toast -->
    <div class="copy-toast" id="copyToast">‚úÖ ¬°Copiado!</div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <img src="https://qtrypzzcjebvfcihiynt.supabase.co/storage/v1/object/public/base44-prod/public/6911b8e453ca3ac01fb134d6/e3f0a8e26_logo_cd_bustarviejo_mediano.jpg" alt="CD Bustarviejo">
            <h1>üéâ ¬°Hazte Socio del CD Bustarviejo!</h1>
            <p>Forma parte de nuestra gran familia deportiva</p>
        </div>

        <!-- Benefits -->
        <div class="benefits">
            <h3>‚≠ê ¬øPor qu√© ser socio?</h3>
            <div class="benefits-grid">
                <div class="benefit-item">
                    <h4>üíö Apoyo esencial al club</h4>
                    <p>Tu aportaci√≥n es vital para el desarrollo de nuestros j√≥venes deportistas</p>
                </div>
                <div class="benefit-item">
                    <h4>üë• Fuerza para la comunidad</h4>
                    <p>√önete a la gran familia del club y vive la pasi√≥n por el deporte</p>
                </div>
                <div class="benefit-item">
                    <h4>üéâ Eventos inolvidables</h4>
                    <p>Participa en las actividades del club y comparte experiencias √∫nicas</p>
                </div>
                <div class="benefit-item">
                    <h4>‚ú® Compromiso con el deporte base</h4>
                    <p>Contribuye al crecimiento y formaci√≥n de nuestros deportistas</p>
                </div>
            </div>
        </div>

        <!-- Share Box -->
        <div class="share-box">
            <h3>ü§ù ¬øConoces a m√°s personas que quieran apoyar al club?</h3>
            <p>¬°Comparte este enlace con familiares y amigos!</p>
            <button class="share-btn" onclick="shareWhatsApp()">
                üí¨ Compartir por WhatsApp
            </button>
        </div>

        <!-- Form -->
        <div class="form-card">
            <div class="form-header">
                <h2>üë• Formulario de Inscripci√≥n como Socio</h2>
            </div>
            <div class="form-body">
                <div class="error-message" id="errorMessage"></div>
                
                <!-- Referral Banner -->
                <div class="referral-banner" id="referralBanner" style="display: none;">
                    <p>üéÅ <strong>¬°Te han invitado!</strong> Al registrarte, quien te invit√≥ recibir√° un premio.</p>
                </div>
                
                <div class="form-content" id="formContent">
                    <form id="memberForm" autocomplete="on">
                        
                        <!-- Tipo inscripci√≥n -->
                        <div class="form-group">
                            <label>Tipo de Inscripci√≥n *</label>
                            <div class="radio-group">
                                <label class="radio-option selected">
                                    <input type="radio" name="tipo_inscripcion" value="Nueva Inscripci√≥n" checked>
                                    <div class="radio-content">
                                        <h4>üÜï Nueva Inscripci√≥n</h4>
                                        <p>Primera vez como socio del club</p>
                                    </div>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="tipo_inscripcion" value="Renovaci√≥n">
                                    <div class="radio-content">
                                        <h4>üîÑ Renovaci√≥n</h4>
                                        <p>Ya fui socio en temporadas anteriores</p>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Datos personales -->
                        <h3 style="margin: 25px 0 15px; color: #1e293b; border-bottom: 2px solid #e2e8f0; padding-bottom: 10px;">Datos del nuevo socio</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="nombre_completo">Nombre y Apellidos *</label>
                                <input type="text" id="nombre_completo" name="nombre_completo" autocomplete="name" placeholder="Ej: Juan Garc√≠a L√≥pez" required>
                            </div>
                            <div class="form-group">
                                <label for="dni">DNI *</label>
                                <input type="text" id="dni" name="dni" autocomplete="off" placeholder="12345678A" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="telefono">Tel√©fono M√≥vil *</label>
                                <input type="tel" id="telefono" name="telefono" autocomplete="tel" placeholder="600123456" required>
                            </div>
                            <div class="form-group">
                                <label for="email">Correo Electr√≥nico *</label>
                                <input type="email" id="email" name="email" autocomplete="email" placeholder="correo@ejemplo.com" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="direccion">Direcci√≥n Completa *</label>
                            <input type="text" id="direccion" name="direccion" autocomplete="street-address" placeholder="Calle, n√∫mero, piso..." required>
                        </div>

                        <div class="form-group">
                            <label for="municipio">Municipio *</label>
                            <input type="text" id="municipio" name="municipio" autocomplete="address-level2" placeholder="Bustarviejo" required>
                        </div>

                        <!-- Pago -->
                        <div class="payment-box">
                            <h3>üí≥ Pago: 25‚Ç¨</h3>
                            
                            <p style="font-size: 0.9rem; color: #166534; margin-bottom: 15px;">Realiza el pago por transferencia bancaria:</p>

                            <div class="bank-details">
                                <p style="font-weight: 600; margin-bottom: 8px;">üìã Datos bancarios (pulsa para copiar):</p>
                                <div class="iban" onclick="copyIBAN()">
                                    ES12 1234 5678 1234 5678 9012
                                    <span style="font-size: 0.75rem; color: #64748b; display: block; margin-top: 5px;">üìã Pulsa para copiar</span>
                                </div>
                                <p class="concept"><strong>Concepto:</strong> SOCIO - <span id="conceptName">Tu nombre</span></p>
                            </div>
                            
                            <!-- Upload justificante -->
                            <div class="upload-section" id="uploadSection">
                                <h4>üì§ Subir Justificante de Pago *</h4>
                                <p>Obligatorio: sube una captura de tu transferencia</p>
                                <input type="file" id="fileInput" class="file-input" accept="image/*,.pdf">
                                <button type="button" class="upload-btn" id="uploadBtn">
                                    üìé Seleccionar archivo
                                </button>
                                <div class="upload-preview" id="uploadPreview">
                                    <span>‚úÖ Justificante subido correctamente</span>
                                </div>
                                <div class="upload-error" id="uploadError">
                                    <span>‚ùå Error al subir el archivo. Int√©ntalo de nuevo.</span>
                                </div>
                            </div>
                        </div>

                        <!-- Submit -->
                        <button type="submit" class="submit-btn" id="submitBtn" disabled>
                            üéâ Enviar Solicitud
                        </button>
                        <p style="text-align: center; margin-top: 10px; font-size: 0.85rem; color: #dc2626;" id="submitHint">
                            ‚ö†Ô∏è Sube el justificante de pago para poder enviar
                        </p>
                    </form>
                </div>

                <!-- Success message -->
                <div class="success-message" id="successMessage">
                    <div style="font-size: 5rem; margin-bottom: 20px;">üéâ</div>
                    <h2>¬°Bienvenido/a a la familia!</h2>
                    <p>Tu solicitud se ha enviado correctamente.</p>
                    <p style="margin-top: 15px;">Recibir√°s tu <strong>carnet virtual</strong> por email en unos minutos.</p>
                    <p style="margin-top: 20px; font-size: 0.9rem; color: #94a3b8;">N√∫mero de socio: <strong id="numeroSocio">---</strong></p>
                    
                    <div style="margin-top: 30px; padding: 20px; background: #ecfdf5; border-radius: 12px;">
                        <p style="color: #166534; font-weight: 600; margin-bottom: 10px;">ü§ù ¬øConoces a m√°s personas?</p>
                        <button class="share-btn" style="background: #16a34a; color: white;" onclick="shareWhatsApp()">
                            üí¨ Compartir por WhatsApp
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>üìß <a href__="mailto:cdbustarviejo@gmail.com">cdbustarviejo@gmail.com</a></p>
            <p style="margin-top: 10px;">üìç Bustarviejo, Madrid</p>
            <p style="margin-top: 15px; font-size: 0.85rem;">¬© CD Bustarviejo - Desde 1980</p>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal-overlay" id="successModal">
        <div class="modal-content">
            <div style="font-size: 5rem;">üéâ</div>
            <h2>¬°Bienvenido/a a la familia!</h2>
            <p>Tu solicitud se ha enviado correctamente.</p>
            <p>Recibir√°s tu <strong>carnet virtual</strong> por email.</p>
            <p style="margin-top: 15px; font-size: 0.9rem; color: #94a3b8;">N√∫mero de socio: <strong id="modalNumeroSocio">---</strong></p>
            <button class="modal-close" onclick="closeModal()">¬°Entendido!</button>
        </div>
    </div>

    <script>
        // URLs de la API
        const API_URL = 'https://app.base44.com/api/p/6911b8e453ca3ac01fb134d6/publicMemberRegistration';
        const UPLOAD_URL = 'https://app.base44.com/api/p/6911b8e453ca3ac01fb134d6/publicFileUpload';
        const LANDING_URL = 'https://manuelbermudo2804-tech.github.io/-club-landing-page-Bustarviejo/';
        
        // Variables globales
        let uploadedFileUrl = null;
        let referrerCode = null;

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            // Leer par√°metros de URL
            const urlParams = new URLSearchParams(window.location.search);
            referrerCode = urlParams.get('ref');
            
            if (referrerCode) {
                document.getElementById('referralBanner').style.display = 'block';
            }

            // Actualizar concepto con el nombre
            document.getElementById('nombre_completo').addEventListener('input', function() {
                document.getElementById('conceptName').textContent = this.value || 'Tu nombre';
            });

            // Radio buttons
            document.querySelectorAll('.radio-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.radio-option').forEach(o => o.classList.remove('selected'));
                    this.classList.add('selected');
                    this.querySelector('input').checked = true;
                });
            });

            // Upload button
            document.getElementById('uploadBtn').addEventListener('click', function() {
                document.getElementById('fileInput').click();
            });

            // File input change
            document.getElementById('fileInput').addEventListener('change', handleFileUpload);

            // Form submit
            document.getElementById('memberForm').addEventListener('submit', handleSubmit);
        });

        // Copiar IBAN
        function copyIBAN() {
            const iban = 'ES12 1234 5678 1234 5678 9012';
            navigator.clipboard.writeText(iban.replace(/\s/g, '')).then(() => {
                showToast();
            });
        }

        // Mostrar toast
        function showToast() {
            const toast = document.getElementById('copyToast');
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }

        // Compartir por WhatsApp
        function shareWhatsApp() {
            const message = `¬°Hazte socio del CD Bustarviejo! ‚öΩüèÄ\n\nPor solo 25‚Ç¨/temporada ayudas a los j√≥venes deportistas del club.\n\nüëâ Reg√≠strate aqu√≠: ${LANDING_URL}\n\n¬°Gracias por tu apoyo! üí™`;
            window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
        }

        // Subir archivo
        async function handleFileUpload(e) {
            const file = e.target.files[0];
            if (!file) return;

            const uploadBtn = document.getElementById('uploadBtn');
            const uploadPreview = document.getElementById('uploadPreview');
            const uploadError = document.getElementById('uploadError');
            const submitBtn = document.getElementById('submitBtn');
            const submitHint = document.getElementById('submitHint');

            // Resetear estados
            uploadPreview.style.display = 'none';
            uploadError.style.display = 'none';
            uploadBtn.disabled = true;
            uploadBtn.textContent = '‚è≥ Subiendo...';

            try {
                const formData = new FormData();
                formData.append('file', file);

                const response = await fetch(UPLOAD_URL, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success && result.file_url) {
                    uploadedFileUrl = result.file_url;
                    uploadPreview.style.display = 'block';
                    uploadBtn.textContent = '‚úÖ Archivo subido';
                    submitBtn.disabled = false;
                    submitHint.style.display = 'none';
                } else {
                    throw new Error(result.error || 'Error al subir');
                }
            } catch (error) {
                console.error('Error uploading file:', error);
                uploadError.style.display = 'block';
                uploadBtn.textContent = 'üìé Seleccionar archivo';
                uploadedFileUrl = null;
            }

            uploadBtn.disabled = false;
        }

        // Enviar formulario
        async function handleSubmit(e) {
            e.preventDefault();

            if (!uploadedFileUrl) {
                alert('Por favor, sube el justificante de pago');
                return;
            }

            const submitBtn = document.getElementById('submitBtn');
            const errorMessage = document.getElementById('errorMessage');
            
            submitBtn.disabled = true;
            submitBtn.textContent = '‚è≥ Enviando...';
            errorMessage.style.display = 'none';

            const formData = {
                tipo_inscripcion: document.querySelector('input[name="tipo_inscripcion"]:checked').value,
                nombre_completo: document.getElementById('nombre_completo').value.trim(),
                dni: document.getElementById('dni').value.trim(),
                telefono: document.getElementById('telefono').value.trim(),
                email: document.getElementById('email').value.trim(),
                direccion: document.getElementById('direccion').value.trim(),
                municipio: document.getElementById('municipio').value.trim(),
                metodo_pago: 'Transferencia',
                justificante_url: uploadedFileUrl,
                es_segundo_progenitor: false
            };

            // A√±adir referido si existe
            if (referrerCode) {
                formData.referido_por = `REF:${referrerCode}`;
            }

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (result.success) {
                    // Mostrar √©xito
                    document.getElementById('formContent').style.display = 'none';
                    document.getElementById('successMessage').style.display = 'block';
                    document.getElementById('numeroSocio').textContent = result.numero_socio;
                    document.getElementById('modalNumeroSocio').textContent = result.numero_socio;
                    document.getElementById('successModal').style.display = 'flex';
                } else {
                    throw new Error(result.error || 'Error al enviar');
                }
            } catch (error) {
                console.error('Error:', error);
                errorMessage.textContent = '‚ùå Error: ' + error.message;
                errorMessage.style.display = 'block';
                submitBtn.disabled = false;
                submitBtn.textContent = 'üéâ Enviar Solicitud';
            }
        }

        // Cerrar modal
        function closeModal() {
            document.getElementById('successModal').style.display = 'none';
        }
    </script>
</body>
</html>
